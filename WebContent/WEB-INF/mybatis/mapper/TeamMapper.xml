<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tel">

	<!-- 팀원 리스트 Low -->
<select id="rowlist" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
select * from member m inner join team t on m.memberId = t.memseq 
		where projectseq = #{projectseq} order by t.grade asc limit #{start},#{pagesize}
	</select>

	<!-- 페이지 사이즈 -->
<select id="pages" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
select count(*) as total, ceil(count(*) / #{pagesize}) as ceil from member m inner join team t on 
	m.memberId = t.memseq where projectseq = #{projectseq} order by t.grade asc
	</select>

	<!-- 페이지 사이즈 정렬 -->
<select id="pages2" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
select count(*) as total, ceil(count(*) / #{pagesize}) as ceil from member m inner join team t on 
	m.memberId = t.memseq where projectseq = #{projectseq} order by m.name asc
	</select>			

	<!-- 페이지 사이즈 검색 -->
<select id="pages3" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
select count(*) as total, ceil(count(*) / #{pagesize}) as ceil from member m inner join team t on 
	m.memberId = t.memseq where projectseq = #{projectseq} and m.${sort} like 
		concat('%', #{word}, '%')
	</select>		
	
	<!-- 이름 정렬 -->
<select id="selTel2" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
select * from member m inner join team t on m.memberId = t.memseq where projectseq = #{projectseq} 
		order by m.name asc limit #{start}, #{pagesize}
	</select>	

	<!-- 검색 -->
<select id="selTeam" resultType="visang.timple.model.TelDTO" parameterType="visang.timple.model.TelDTO">
		
select * from member m inner join team t on m.memberId = t.memseq where projectseq = 
	#{projectseq} and m.${sort} like concat('%', #{word} ,'%') limit #{start},#{pagesize}
	</select>	

	<!-- 회원 번호 받기 -->
	<select id="who" resultType="String" parameterType="String">
		select memberId from member where name = #{name}
	</select>	
	
	<!-- 멤버 체크 -->
	<select id="checkmember" resultType="String" parameterType="String">
		select count(*) from team where projectseq = #{projectseq} and memseq = #{who};
	</select>	
	
	<!-- 회원 번호로 insert -->
	<select id="addMember" parameterType="java.util.HashMap">
		insert into team (teamid, projectseq, memseq, grade, participation) values 
	(null, #{projectseq}, #{who}, 2, 2)
	</select>	
	
	<!-- 암호 확인 -->
	<select id="PassCheck" resultType="String" parameterType="java.util.HashMap">
		select count(*) from member where memberId = #{memberid} and pw = password(#{pw})
	</select>
	
	<!-- 글 삭제 -->
	<select id="Del" parameterType="String">
		delete from team where teamid = #{teamid}
	</select>

	<!-- 글 수정 -->
	<select id="Fix" parameterType="visang.timple.model.TelDTO" resultType="String">
		update member set name = #{fixname}, email = #{fixemail}, tel = #{fixtel}  
	where memberId = #{fixmem}
	</select>
	
	<!-- 팀장 구하기 -->
	<select id="one" parameterType="visang.timple.model.TelDTO" resultType="String">
		select count(*) from team where memseq = #{memseq} and grade = 1 and 
			projectseq = #{projectseq}
	</select>	
	
	<!-- 팀장 암호 -->
	<select id="onePw" parameterType="java.util.HashMap" resultType="String">
		select count(*) from member where memberId = #{team} and pw = password(#{pw})
	</select>	

	<!-- 알림 전송 -->
	<select id="news" parameterType="java.util.HashMap" resultType="String">	
insert into notification ( notificationid, memseq, content, confirm) values 
	(null, #{teamid},'프로젝트 에서 탈퇴 처리 되셨습니다!','n');
	</select>	

	<!-- 직위 구하기 -->
	<select id="grade" parameterType="visang.timple.model.TelDTO" resultType="String">	
select grade from team where memseq = #{memseq} and projectseq = #{projectseq};
	</select>

<!--=============================================================================================-->	
	<!-- 메모 회원 리스트 -->
<select id="memolist" resultType="visang.timple.model.MemoDTO" parameterType="visang.timple.model.MemoDTO">


select t.teamid, t.projectseq, t.memseq, m.memberId, m.name, m.pw, m.profile, mo.teammemoid, 
	mo.teamseq, mo.content, DATE_FORMAT(mo.regdate, '%Y-%m-%d %H:%i') as regdate, 
	mo.theme from team t inner join member m on t.memseq = m.memberId 
		inner join teammemo mo on  t.teamid = mo.teamseq 
where t.projectseq = #{projectseq} order by mo.regdate desc limit #{start},#{pagesize}
		
	</select> 

	<!-- 메모 페이지 -->
 <select id="memopage" resultType="visang.timple.model.MemoDTO" parameterType="visang.timple.model.MemoDTO">

select count(*) as total, ceil(count(*) / #{pagesize}) as ceil from team t inner join 
	member m on t.memseq = m.memberId inner join teammemo mo on t.teamid = mo.teamseq 
		where t.projectseq = #{projectseq} order by mo.regdate desc		
	</select>

	<!-- 이름 암호 확인 -->
 <select id="memoCheck" resultType="String" parameterType="visang.timple.model.MemoDTO">
	select count(*) from member where name = #{name} and  pw = password(#{pw})	
 </select>

	<!-- 팀 아이디 구하기 -->
 <select id="getTeamid" resultType="String" parameterType="visang.timple.model.MemoDTO">
	select t.teamid from member m inner join team t on t.memseq = m.memberId 
		where name = #{name} and pw = #{pw}		
 </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	<!-- 메모 등록 하기 -->
 <select id="memoWrite" parameterType="visang.timple.model.MemoDTO">
	insert into teammemo (teammemoid, teamseq, subject, content, theme) values 
	(null, #{teamseq}, '123', #{content}, null);	
 </select>
 
	<!-- 메모 수정 하기 -->
 <select id="memoFix" parameterType="visang.timple.model.MemoDTO">
		update teammemo set content = #{content} where teammemoid = #{teammemoid}
 </select> 
 
	<!-- 메모 삭제 하기 -->
 <select id="memoDel" parameterType="visang.timple.model.MemoDTO">
		delete from teammemo where teammemoid = #{teammemoid}
 </select>   
</mapper>









